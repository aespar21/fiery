<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Delaying code execution in Fiery — delay_doc • fiery</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Delaying code execution in Fiery — delay_doc" />
<meta property="og:description" content="R, and thus fiery, is single threaded, meaning that every request must be
handled one at a time. Because of this it is of utmost importance to keep the
computation time for each request handling as low as possible so that the
server does not become unresponsive. Still, sometimes you may need to perform
long running computations as part of the server functionality. fiery comes
with three different facilities for this, each with its own use case. All of
them are build on top of future." />
<meta property="og:image" content="https://fiery.data-imaginist.com/logo.png" />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fiery</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/thomasp85/fiery">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Delaying code execution in Fiery</h1>
    <small class="dont-index">Source: <a href='https://github.com/thomasp85/fiery/blob/master/R/delay_doc.R'><code>R/delay_doc.R</code></a></small>
    <div class="hidden name"><code>delay_doc.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>R, and thus <code>fiery</code>, is single threaded, meaning that every request must be
handled one at a time. Because of this it is of utmost importance to keep the
computation time for each request handling as low as possible so that the
server does not become unresponsive. Still, sometimes you may need to perform
long running computations as part of the server functionality. <code>fiery</code> comes
with three different facilities for this, each with its own use case. All of
them are build on top of <a href='https://rdrr.io/pkg/future/man/future.html'>future</a>.</p>
    </div>



    <h2 class="hasAnchor" id="general-format"><a class="anchor" href="#general-format"></a>General format</h2>

    

<p>All three methods have the same general API. They can recieve an expression
to evaluate, as well as a <code>then</code> function to call once the evaluation
eventually completes. The <code>then</code> function will recieve the result of the
provided expression as well as the server itself. In general, any code that
works on the server should be handled by the <code>then</code> function as the
expression will not necessarily have access to the current environment. Thus,
the expression should be as minimal as possible while still containing the
heavy part of the calculations, while the <code>then</code> function should be used to
act upon the result of the expression.</p>
<p>The general format is thus (using <code>delay()</code> as an example):</p><pre>app$delay({
  # Heavy calculation
}, then = function(res, server) {
  # Do something with 'res' (the result of the expression) and 'server' the 
  # server object itself
})
</pre>

    <h2 class="hasAnchor" id="pushing-execution-to-the-end-of-a-cycle"><a class="anchor" href="#pushing-execution-to-the-end-of-a-cycle"></a>Pushing execution to the end of a cycle</h2>

    

<p>If it is important to achieve a fast response time, but server congestion is
of lesser concern (the server might be used for a local app with only one
user at a time), the <code>delay()</code> method can be used to push the evaluation of
long running computation to the end of the current cycle. It will of course
not be possible to return the result of the computation as part of the
response, but e.g. a <code>202</code> response can be returned instead indicating that
the request is being processed. In that way the client can act accordingly
without appearing frozen. An alternative if a lengthy POST request is
recieved is to return <code>303</code> with a reference to the URL where the result can
be recieved.</p>
    <h2 class="hasAnchor" id="executing-in-another-process"><a class="anchor" href="#executing-in-another-process"></a>Executing in another process</h2>

    

<p>If long running computations are needed and congestion is an issue it does
not help to simply push back execution to the end of the cycle as this will
block requests while the code is evaluating. Instead it is possible to use
the <code>async()</code> method to evaluate the expression in another thread. This
method uses <code><a href='https://rdrr.io/pkg/future/man/multiprocess.html'>future::multiprocess()</a></code> to evaluate the expression and may thus
fork the current R process if supported (Unix systems) or start another R
session (Windows). At the end of each cycle all async evaluations are checked
for completion, and if completed the <code>then</code> function will be called with the
result. If the async evaluation is not completed it will continue to churn.</p>
    <h2 class="hasAnchor" id="executing-after-a-time-interval"><a class="anchor" href="#executing-after-a-time-interval"></a>Executing after a time interval</h2>

    

<p>If code is meant to be evaluated after a certain amount of time has passed,
use the <code>time()</code> method. In addition to <code>expr</code> and <code>then</code>, <code>time()</code> takes two
additional arguments: <code>after</code> (the time in seconds to wait before evaluation)
and <code>loop</code> (whether to repeat the timed evaluation after completion). Using
<code>loop = TRUE</code> it is e.g. possible to continually check for state changes on
the server and e.g. run some specific code if new files appear in a
directory. In the end of each cycle all timed expressions will be checked for
whether they should be evaluated and run if their specific time interval has
passed.</p>
    <h2 class="hasAnchor" id="error-handling"><a class="anchor" href="#error-handling"></a>Error handling</h2>

    

<p>As both the expression and <code>then</code> function might throw errors they are
evaluated in a safe context and any errors that might occur will be send to
the <a href='loggers.html'>server log</a> without affecting other waiting evaluations.</p>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#general-format">General format</a></li>
      <li><a href="#pushing-execution-to-the-end-of-a-cycle">Pushing execution to the end of a cycle</a></li>
      <li><a href="#executing-in-another-process">Executing in another process</a></li>
      <li><a href="#executing-after-a-time-interval">Executing after a time interval</a></li>
      <li><a href="#error-handling">Error handling</a></li>
    </ul>

  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by <a href='https://data-imaginist.com'>Thomas Lin Pedersen</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


